<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>SMC sampler — smcSampler â€¢ BayesianTools</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">BayesianTools</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/BayesianTools.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/florianhartig/BayesianTools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>SMC sampler</h1>
    </div>

    
    <p>Sequential Monte Carlo Sampler</p>
    

    <pre class="usage"><span class='fu'>smcSampler</span>(<span class='no'>bayesianSetup</span>, <span class='kw'>initialParticles</span> <span class='kw'>=</span> <span class='fl'>1000</span>, <span class='kw'>iterations</span> <span class='kw'>=</span> <span class='fl'>10</span>,
  <span class='kw'>resampling</span> <span class='kw'>=</span> <span class='no'>T</span>, <span class='kw'>resamplingSteps</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>proposal</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>adaptive</span> <span class='kw'>=</span> <span class='no'>T</span>,
  <span class='kw'>proposalScale</span> <span class='kw'>=</span> <span class='fl'>0.5</span>, <span class='kw'>likelihoodWeights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>bayesianSetup</th>
      <td><p>either an object of class bayesianSetup created by <code><a href='createBayesianSetup.html'>createBayesianSetup</a></code> (recommended), or a log target function</p></td>
    </tr>
    <tr>
      <th>initialParticles</th>
      <td><p>initial particles - either a draw from the prior, provided as a matrix with the single parameters as columns and each row being one particle (parameter vector), or a numeric value with the number of desired particles. In this case, the sampling option must be provided in the prior of the BayesianSetup.</p></td>
    </tr>
    <tr>
      <th>iterations</th>
      <td><p>number of iterations</p></td>
    </tr>
    <tr>
      <th>resampling</th>
      <td><p>if new particles should be created at each iteration</p></td>
    </tr>
    <tr>
      <th>resamplingSteps</th>
      <td><p>how many resampling (MCMC) steps between the iterations</p></td>
    </tr>
    <tr>
      <th>proposal</th>
      <td><p>optional proposal class</p></td>
    </tr>
    <tr>
      <th>adaptive</th>
      <td><p>should the covariance of the proposal be adapted during sampling</p></td>
    </tr>
    <tr>
      <th>proposalScale</th>
      <td><p>scaling factor for the proposal generation. Can be adapted if there is too much / too little rejection</p></td>
    </tr>
    <tr>
      <th>likelihoodWeights</th>
      <td><p>NULL, numeric vector, or function. The sum of all weights must be one, and the length of the vector must be equal to iterations. The value of the nth element determines the weight for the likelihood in the nth iteration.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The sampler can be used for rejection sampling as well as for sequential Monte Carlo. For the former case set the iterations to one.</p>
    
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>The SMC currently assumes that the initial particle is sampled from the prior. If a better initial estimate of the posterior distribution is available, this the sampler should be modified to include this. Currently, however, this is not included in the code, so the appropriate adjustments have to be done by hand.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## Example for the use of SMC </span>
<span class='co'># First we need a bayesianSetup - SMC makes most sense if we can  for demonstration,</span>
<span class='co'># we'll write a function that puts out the number of model calls</span>

<span class='no'>MultiNomialNoCor</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='generateTestDensityMultiNormal.html'>generateTestDensityMultiNormal</a></span>(<span class='kw'>sigma</span> <span class='kw'>=</span> <span class='st'>"no correlation"</span>)

<span class='no'>parallelLL</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>parMatrix</span>){
  <span class='fu'>print</span>(<span class='fu'>paste</span>(<span class='st'>"Calling likelihood with"</span>, <span class='fu'>nrow</span>(<span class='no'>parMatrix</span>), <span class='st'>"parameter combinations"</span>))
  <span class='no'>out</span> <span class='kw'>=</span> <span class='fu'>apply</span>(<span class='no'>parMatrix</span>, <span class='fl'>1</span>, <span class='no'>MultiNomialNoCor</span>)
  <span class='fu'>return</span>(<span class='no'>out</span>)
}

<span class='no'>bayesianSetup</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='createBayesianSetup.html'>createBayesianSetup</a></span>(<span class='kw'>likelihood</span> <span class='kw'>=</span> <span class='no'>parallelLL</span>, <span class='kw'>lower</span> <span class='kw'>=</span> <span class='fu'>rep</span>(-<span class='fl'>10</span>, <span class='fl'>3</span>),
                                     <span class='kw'>upper</span> <span class='kw'>=</span> <span class='fu'>rep</span>(<span class='fl'>10</span>, <span class='fl'>3</span>), <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='st'>"external"</span>)

<span class='co'># Defining settings for the sampler</span>
<span class='co'># First we use the sampler for rejection sampling</span>
<span class='no'>settings</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(<span class='kw'>initialParticles</span> <span class='kw'>=</span> <span class='fl'>1000</span>, <span class='kw'>iterations</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>resampling</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='co'># Running the sampler</span>
<span class='no'>out1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='runMCMC.html'>runMCMC</a></span>(<span class='kw'>bayesianSetup</span> <span class='kw'>=</span> <span class='no'>bayesianSetup</span>, <span class='kw'>sampler</span> <span class='kw'>=</span> <span class='st'>"SMC"</span>, <span class='kw'>settings</span> <span class='kw'>=</span> <span class='no'>settings</span>)</div><div class='output co'>#&gt; [1] 1
#&gt; [1] "Calling likelihood with 1000 parameter combinations"
#&gt; [1] 2.984645</div><div class='img'><img src='smcSampler-73.png' alt='' width='700' height='432.632880098887' /></div><div class='img'><img src='smcSampler-74.png' alt='' width='700' height='432.632880098887' /></div><div class='output co'>#&gt; [1] 26</div><div class='output co'>#&gt; <span class='message'>runMCMC terminated after 0.829999999999927seconds</span></div><div class='img'><img src='smcSampler-75.png' alt='' width='700' height='432.632880098887' /></div><div class='input'><span class='co'>#plot(out1)</span>


<span class='co'># Now for sequential Monte Carlo</span>
<span class='no'>settings</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(<span class='kw'>initialParticles</span> <span class='kw'>=</span> <span class='fl'>100</span>, <span class='kw'>iterations</span> <span class='kw'>=</span> <span class='fl'>5</span>, <span class='kw'>resamplingSteps</span> <span class='kw'>=</span> <span class='fl'>1</span>)
<span class='no'>out2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='runMCMC.html'>runMCMC</a></span>(<span class='kw'>bayesianSetup</span> <span class='kw'>=</span> <span class='no'>bayesianSetup</span>, <span class='kw'>sampler</span> <span class='kw'>=</span> <span class='st'>"SMC"</span>, <span class='kw'>settings</span> <span class='kw'>=</span> <span class='no'>settings</span>)</div><div class='output co'>#&gt; [1] 0.2 0.2 0.2 0.2 0.2
#&gt; [1] "Calling likelihood with 100 parameter combinations"
#&gt; [1] 3.31721</div><div class='img'><img src='smcSampler-76.png' alt='' width='700' height='432.632880098887' /></div><div class='img'><img src='smcSampler-77.png' alt='' width='700' height='432.632880098887' /></div><div class='img'><img src='smcSampler-78.png' alt='' width='700' height='432.632880098887' /></div><div class='output co'>#&gt; [1] 17
#&gt; [1] "Calling likelihood with 2 parameter combinations"
#&gt; [1] "Calling likelihood with 100 parameter combinations"
#&gt; [1] 47.89169</div><div class='img'><img src='smcSampler-79.png' alt='' width='700' height='432.632880098887' /></div><div class='img'><img src='smcSampler-80.png' alt='' width='700' height='432.632880098887' /></div><div class='img'><img src='smcSampler-81.png' alt='' width='700' height='432.632880098887' /></div><div class='output co'>#&gt; [1] 49
#&gt; [1] "Calling likelihood with 2 parameter combinations"
#&gt; [1] "Calling likelihood with 100 parameter combinations"
#&gt; [1] 82.96134</div><div class='img'><img src='smcSampler-82.png' alt='' width='700' height='432.632880098887' /></div><div class='img'><img src='smcSampler-83.png' alt='' width='700' height='432.632880098887' /></div><div class='img'><img src='smcSampler-84.png' alt='' width='700' height='432.632880098887' /></div><div class='output co'>#&gt; [1] 66
#&gt; [1] "Calling likelihood with 3 parameter combinations"
#&gt; [1] "Calling likelihood with 100 parameter combinations"
#&gt; [1] 89.32615</div><div class='img'><img src='smcSampler-85.png' alt='' width='700' height='432.632880098887' /></div><div class='img'><img src='smcSampler-86.png' alt='' width='700' height='432.632880098887' /></div><div class='img'><img src='smcSampler-87.png' alt='' width='700' height='432.632880098887' /></div><div class='output co'>#&gt; [1] 63
#&gt; [1] "Calling likelihood with 100 parameter combinations"
#&gt; [1] 95.49201</div><div class='img'><img src='smcSampler-88.png' alt='' width='700' height='432.632880098887' /></div><div class='img'><img src='smcSampler-89.png' alt='' width='700' height='432.632880098887' /></div><div class='output co'>#&gt; [1] 63
#&gt; [1] "Calling likelihood with  parameter combinations"
#&gt; Parameter values  -7.49454366195938 -6.57156059686812 -7.17224688752869 </div><div class='output co'>#&gt; <span class='warning'>Warning: Problem encountered in the calculation of the likelihood with parameter -7.49454366195938-6.57156059686812-7.17224688752869</span>
#&gt; <span class='warning'> Error message wasError in apply(parMatrix, 1, MultiNomialNoCor): dim(X) must have a positive length</span>
#&gt; <span class='warning'></span>
#&gt; <span class='warning'> set result of the parameter evaluation to -Inf ParaeterValues </span></div><div class='output co'>#&gt; <span class='message'>runMCMC terminated after 0.190000000000055seconds</span></div><div class='img'><img src='smcSampler-90.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>#plot(out2)

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#note">Note</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Florian Hartig

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Florian Hartig, Francesco Minunno, Stefan  Paul.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
