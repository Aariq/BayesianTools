<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calcluated the marginal likelihood from a set of MCMC samples — marginalLikelihood â€¢ BayesianTools</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">BayesianTools</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/BayesianTools.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/florianhartig/BayesianTools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calcluated the marginal likelihood from a set of MCMC samples</h1>
    </div>

    
    <p>Calcluated the marginal likelihood from a set of MCMC samples</p>
    

    <pre class="usage"><span class='fu'>marginalLikelihood</span>(<span class='no'>sampler</span>, <span class='kw'>numSamples</span> <span class='kw'>=</span> <span class='fl'>1000</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"Chib"</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>sampler</th>
      <td><p>an object that implements the getSample function, i.e. a mcmc / smc Sampler (list)</p></td>
    </tr>
    <tr>
      <th>numSamples</th>
      <td><p>number of samples to use. How this works, and if it requires recalculating the likelihood, depends on the method</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>method to choose. Currently available are "Chib" (default), the harmonic mean "HM", sampling from the prior "prior", and bridge sampling "Bridge". See details</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>further arguments passed to <code><a href='getSample.html'>getSample</a></code></p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function currently implements four ways to calculate the marginal likelihood.
 The recommended way is the method "Chib" (Chib and Jeliazkov, 2001). which is based on MCMC samples, but performs additional calculations. 
 Despite being the current recommendation, note there are some numeric issues with this algorithm that may limit reliability for larger dimensions.</p>  
<p>The harmonic mean approximation,
  is implemented only for comparison. Note that the method is numerically 
  unrealiable and usually should not be used.</p>
<p>The third method is simply sampling from the prior. While in principle unbiased,
 it will only converge for a large number of samples, and is therefore
  numerically inefficient.</p>
<p>The Bridge method uses bridge sampling as implemented in the R package "bridgesampling".</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Chib, Siddhartha, and Ivan Jeliazkov. "Marginal likelihood from the Metropolis-Hastings output." Journal of the American Statistical Association 96.453 (2001): 270-281.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='WAIC.html'>WAIC</a></code>, <code><a href='DIC.html'>DIC</a></code>, <code><a href='MAP.html'>MAP</a></code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Harmonic mean works OK for a low-dim case with </span>

<span class='no'>likelihood</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'>sum</span>(<span class='fu'>dnorm</span>(<span class='no'>x</span>, <span class='kw'>log</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>))
<span class='no'>prior</span> <span class='kw'>=</span> <span class='fu'><a href='createUniformPrior.html'>createUniformPrior</a></span>(<span class='kw'>lower</span> <span class='kw'>=</span> <span class='fu'>rep</span>(-<span class='fl'>1</span>,<span class='fl'>2</span>), <span class='kw'>upper</span> <span class='kw'>=</span> <span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fl'>2</span>))
<span class='no'>bayesianSetup</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='createBayesianSetup.html'>createBayesianSetup</a></span>(<span class='kw'>likelihood</span> <span class='kw'>=</span> <span class='no'>likelihood</span>, <span class='kw'>prior</span> <span class='kw'>=</span> <span class='no'>prior</span>)
<span class='no'>out</span> <span class='kw'>=</span> <span class='fu'><a href='runMCMC.html'>runMCMC</a></span>(<span class='kw'>bayesianSetup</span> <span class='kw'>=</span> <span class='no'>bayesianSetup</span>, <span class='kw'>settings</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>iterations</span> <span class='kw'>=</span> <span class='fl'>5000</span>))</div><div class='output co'>#&gt;  Running DEzs-MCMC, chain  1 iteration 300 of 5001 . Current logp  -3.231946 -3.22838 -3.702234 . Please wait!  Running DEzs-MCMC, chain  1 iteration 600 of 5001 . Current logp  -3.650859 -3.465972 -3.512521 . Please wait!  Running DEzs-MCMC, chain  1 iteration 900 of 5001 . Current logp  -3.609262 -3.471144 -3.339216 . Please wait!  Running DEzs-MCMC, chain  1 iteration 1200 of 5001 . Current logp  -3.58876 -3.691328 -3.307711 . Please wait!  Running DEzs-MCMC, chain  1 iteration 1500 of 5001 . Current logp  -3.821757 -3.323898 -3.385563 . Please wait!  Running DEzs-MCMC, chain  1 iteration 1800 of 5001 . Current logp  -3.23847 -3.725506 -3.288343 . Please wait!  Running DEzs-MCMC, chain  1 iteration 2100 of 5001 . Current logp  -3.394055 -3.738272 -3.327836 . Please wait!  Running DEzs-MCMC, chain  1 iteration 2400 of 5001 . Current logp  -3.548363 -3.569064 -3.510509 . Please wait!  Running DEzs-MCMC, chain  1 iteration 2700 of 5001 . Current logp  -3.759792 -3.226294 -3.723042 . Please wait!  Running DEzs-MCMC, chain  1 iteration 3000 of 5001 . Current logp  -3.645238 -3.313713 -3.421209 . Please wait!  Running DEzs-MCMC, chain  1 iteration 3300 of 5001 . Current logp  -3.551052 -3.465299 -3.66877 . Please wait!  Running DEzs-MCMC, chain  1 iteration 3600 of 5001 . Current logp  -3.272982 -3.333179 -3.631589 . Please wait!  Running DEzs-MCMC, chain  1 iteration 3900 of 5001 . Current logp  -3.250819 -3.700023 -3.709891 . Please wait!  Running DEzs-MCMC, chain  1 iteration 4200 of 5001 . Current logp  -3.312153 -3.270711 -3.244133 . Please wait!  Running DEzs-MCMC, chain  1 iteration 4500 of 5001 . Current logp  -3.728044 -3.569831 -4.068991 . Please wait!  Running DEzs-MCMC, chain  1 iteration 4800 of 5001 . Current logp  -3.370315 -3.700947 -3.653093 . Please wait!  Running DEzs-MCMC, chain  1 iteration 5001 of 5001 . Current logp  -3.400083 -3.660208 -3.874071 . Please wait! </div><div class='output co'>#&gt; <span class='message'>runMCMC terminated after 1.17000000000007seconds</span></div><div class='input'>
<span class='fu'>plot</span>(<span class='no'>out</span>)</div><div class='img'><img src='marginalLikelihood-9.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>

<span class='fu'>marginalLikelihood</span>(<span class='no'>out</span>, <span class='kw'>numSamples</span> <span class='kw'>=</span> <span class='fl'>500</span>)<span class='kw'>[[</span><span class='fl'>1</span>]]</div><div class='output co'>#&gt; <span class='warning'>Warning: Note to the user: be aware that marginal likelihood calculations are notoriously prone to numerical stability issues. Especially in high-dimensional parameter spaces, there is no guarantee that the algorithms implemented in this function converge in all cases. Proceed at your own risk!</span></div><div class='output co'>#&gt; [1] -2.045501</div><div class='input'><span class='fu'>marginalLikelihood</span>(<span class='no'>out</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"HM"</span>, <span class='kw'>numSamples</span> <span class='kw'>=</span> <span class='fl'>500</span>)<span class='kw'>[[</span><span class='fl'>1</span>]]</div><div class='output co'>#&gt; <span class='warning'>Warning: Note to the user: be aware that marginal likelihood calculations are notoriously prone to numerical stability issues. Especially in high-dimensional parameter spaces, there is no guarantee that the algorithms implemented in this function converge in all cases. Proceed at your own risk!</span></div><div class='output co'>#&gt; [1] -2.148932</div><div class='input'><span class='fu'>marginalLikelihood</span>(<span class='no'>out</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"Prior"</span>, <span class='kw'>numSamples</span> <span class='kw'>=</span>  <span class='fl'>500</span>)<span class='kw'>[[</span><span class='fl'>1</span>]]</div><div class='output co'>#&gt; <span class='warning'>Warning: Note to the user: be aware that marginal likelihood calculations are notoriously prone to numerical stability issues. Especially in high-dimensional parameter spaces, there is no guarantee that the algorithms implemented in this function converge in all cases. Proceed at your own risk!</span></div><div class='output co'>#&gt; [1] -2.144425</div><div class='input'><span class='fu'>marginalLikelihood</span>(<span class='no'>out</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"Bridge"</span>, <span class='kw'>numSamples</span> <span class='kw'>=</span>  <span class='fl'>500</span>)<span class='kw'>[[</span><span class='fl'>1</span>]]</div><div class='output co'>#&gt; Iteration: 1
#&gt; Iteration: 2
#&gt; Iteration: 3
#&gt; Iteration: 4
#&gt; Iteration: 5
#&gt; Iteration: 6
#&gt; Iteration: 7</div><div class='output co'>#&gt; <span class='warning'>Warning: Note to the user: be aware that marginal likelihood calculations are notoriously prone to numerical stability issues. Especially in high-dimensional parameter spaces, there is no guarantee that the algorithms implemented in this function converge in all cases. Proceed at your own risk!</span></div><div class='output co'>#&gt; [1] -2.108433</div><div class='input'>
<span class='co'># True marginal likelihood (brute force approximation)</span>

<span class='fu'>marginalLikelihood</span>(<span class='no'>out</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"Prior"</span>, <span class='kw'>numSamples</span> <span class='kw'>=</span>  <span class='fl'>10000</span>)<span class='kw'>[[</span><span class='fl'>1</span>]]</div><div class='output co'>#&gt; <span class='warning'>Warning: Note to the user: be aware that marginal likelihood calculations are notoriously prone to numerical stability issues. Especially in high-dimensional parameter spaces, there is no guarantee that the algorithms implemented in this function converge in all cases. Proceed at your own risk!</span></div><div class='output co'>#&gt; [1] -2.152117</div><div class='input'>

<span class='co'># Harmonic mean goes totally wrong for higher dimensions - wide prior.</span>
<span class='co'># Same goes for standard bridge sampling.</span>
<span class='co'># Could also be a problem of numeric stability of the implementation</span>

<span class='no'>likelihood</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'>sum</span>(<span class='fu'>dnorm</span>(<span class='no'>x</span>, <span class='kw'>log</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>))
<span class='no'>prior</span> <span class='kw'>=</span> <span class='fu'><a href='createUniformPrior.html'>createUniformPrior</a></span>(<span class='kw'>lower</span> <span class='kw'>=</span> <span class='fu'>rep</span>(-<span class='fl'>10</span>,<span class='fl'>3</span>), <span class='kw'>upper</span> <span class='kw'>=</span> <span class='fu'>rep</span>(<span class='fl'>10</span>,<span class='fl'>3</span>))
<span class='no'>bayesianSetup</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='createBayesianSetup.html'>createBayesianSetup</a></span>(<span class='kw'>likelihood</span> <span class='kw'>=</span> <span class='no'>likelihood</span>, <span class='kw'>prior</span> <span class='kw'>=</span> <span class='no'>prior</span>)
<span class='no'>out</span> <span class='kw'>=</span> <span class='fu'><a href='runMCMC.html'>runMCMC</a></span>(<span class='kw'>bayesianSetup</span> <span class='kw'>=</span> <span class='no'>bayesianSetup</span>, <span class='kw'>settings</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>iterations</span> <span class='kw'>=</span> <span class='fl'>5000</span>))</div><div class='output co'>#&gt;  Running DEzs-MCMC, chain  1 iteration 300 of 5001 . Current logp  -12.3117 -16.32338 -13.25312 . Please wait!  Running DEzs-MCMC, chain  1 iteration 600 of 5001 . Current logp  -13.15733 -12.68131 -14.6254 . Please wait!  Running DEzs-MCMC, chain  1 iteration 900 of 5001 . Current logp  -12.55761 -12.41566 -12.51362 . Please wait!  Running DEzs-MCMC, chain  1 iteration 1200 of 5001 . Current logp  -11.8798 -12.53557 -14.97952 . Please wait!  Running DEzs-MCMC, chain  1 iteration 1500 of 5001 . Current logp  -12.97593 -12.59545 -13.68896 . Please wait!  Running DEzs-MCMC, chain  1 iteration 1800 of 5001 . Current logp  -12.97854 -13.25449 -12.38997 . Please wait!  Running DEzs-MCMC, chain  1 iteration 2100 of 5001 . Current logp  -12.13808 -13.44797 -14.34677 . Please wait!  Running DEzs-MCMC, chain  1 iteration 2400 of 5001 . Current logp  -11.90999 -12.65168 -14.10616 . Please wait!  Running DEzs-MCMC, chain  1 iteration 2700 of 5001 . Current logp  -13.22604 -13.94732 -12.74675 . Please wait!  Running DEzs-MCMC, chain  1 iteration 3000 of 5001 . Current logp  -12.94641 -11.99008 -12.02827 . Please wait!  Running DEzs-MCMC, chain  1 iteration 3300 of 5001 . Current logp  -11.80098 -13.23051 -16.26073 . Please wait!  Running DEzs-MCMC, chain  1 iteration 3600 of 5001 . Current logp  -12.41389 -12.22136 -14.67628 . Please wait!  Running DEzs-MCMC, chain  1 iteration 3900 of 5001 . Current logp  -14.31968 -14.49065 -12.45884 . Please wait!  Running DEzs-MCMC, chain  1 iteration 4200 of 5001 . Current logp  -12.56762 -14.59702 -12.7141 . Please wait!  Running DEzs-MCMC, chain  1 iteration 4500 of 5001 . Current logp  -12.98071 -13.00499 -13.57345 . Please wait!  Running DEzs-MCMC, chain  1 iteration 4800 of 5001 . Current logp  -12.01666 -12.73201 -12.8051 . Please wait!  Running DEzs-MCMC, chain  1 iteration 5001 of 5001 . Current logp  -14.10143 -12.14869 -14.50727 . Please wait! </div><div class='output co'>#&gt; <span class='message'>runMCMC terminated after 0.5seconds</span></div><div class='input'>
<span class='fu'>plot</span>(<span class='no'>out</span>)</div><div class='img'><img src='marginalLikelihood-10.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>
<span class='fu'>marginalLikelihood</span>(<span class='no'>out</span>, <span class='kw'>numSamples</span> <span class='kw'>=</span> <span class='fl'>500</span>)<span class='kw'>[[</span><span class='fl'>1</span>]]</div><div class='output co'>#&gt; <span class='warning'>Warning: Note to the user: be aware that marginal likelihood calculations are notoriously prone to numerical stability issues. Especially in high-dimensional parameter spaces, there is no guarantee that the algorithms implemented in this function converge in all cases. Proceed at your own risk!</span></div><div class='output co'>#&gt; [1] -8.986955</div><div class='input'><span class='fu'>marginalLikelihood</span>(<span class='no'>out</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"HM"</span>, <span class='kw'>numSamples</span> <span class='kw'>=</span> <span class='fl'>500</span>)<span class='kw'>[[</span><span class='fl'>1</span>]]</div><div class='output co'>#&gt; <span class='warning'>Warning: Note to the user: be aware that marginal likelihood calculations are notoriously prone to numerical stability issues. Especially in high-dimensional parameter spaces, there is no guarantee that the algorithms implemented in this function converge in all cases. Proceed at your own risk!</span></div><div class='output co'>#&gt; [1] -38.51889</div><div class='input'><span class='fu'>marginalLikelihood</span>(<span class='no'>out</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"Prior"</span>, <span class='kw'>numSamples</span> <span class='kw'>=</span>  <span class='fl'>500</span>)<span class='kw'>[[</span><span class='fl'>1</span>]]</div><div class='output co'>#&gt; <span class='warning'>Warning: Note to the user: be aware that marginal likelihood calculations are notoriously prone to numerical stability issues. Especially in high-dimensional parameter spaces, there is no guarantee that the algorithms implemented in this function converge in all cases. Proceed at your own risk!</span></div><div class='output co'>#&gt; [1] -9.173093</div><div class='input'><span class='fu'>marginalLikelihood</span>(<span class='no'>out</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"Bridge"</span>, <span class='kw'>numSamples</span> <span class='kw'>=</span>  <span class='fl'>500</span>)<span class='kw'>[[</span><span class='fl'>1</span>]]</div><div class='output co'>#&gt; Iteration: 1
#&gt; Iteration: 2
#&gt; Iteration: 3
#&gt; Iteration: 4
#&gt; Iteration: 5
#&gt; Iteration: 6
#&gt; Iteration: 7
#&gt; Iteration: 8
#&gt; Iteration: 9
#&gt; Iteration: 10
#&gt; Iteration: 11
#&gt; Iteration: 12
#&gt; Iteration: 13
#&gt; Iteration: 14
#&gt; Iteration: 15
#&gt; Iteration: 16
#&gt; Iteration: 17
#&gt; Iteration: 18</div><div class='output co'>#&gt; <span class='warning'>Warning: Note to the user: be aware that marginal likelihood calculations are notoriously prone to numerical stability issues. Especially in high-dimensional parameter spaces, there is no guarantee that the algorithms implemented in this function converge in all cases. Proceed at your own risk!</span></div><div class='output co'>#&gt; [1] -41.42371</div><div class='input'>
<span class='co'># True marginal likelihood (brute force approximation)</span>

<span class='fu'>marginalLikelihood</span>(<span class='no'>out</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"Prior"</span>, <span class='kw'>numSamples</span> <span class='kw'>=</span>  <span class='fl'>10000</span>)<span class='kw'>[[</span><span class='fl'>1</span>]]</div><div class='output co'>#&gt; <span class='warning'>Warning: Note to the user: be aware that marginal likelihood calculations are notoriously prone to numerical stability issues. Especially in high-dimensional parameter spaces, there is no guarantee that the algorithms implemented in this function converge in all cases. Proceed at your own risk!</span></div><div class='output co'>#&gt; [1] -9.229592</div><div class='input'>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Florian Hartig

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Florian Hartig, Francesco Minunno, Stefan  Paul.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
