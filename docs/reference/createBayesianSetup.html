<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Creates a standardized collection of prior, likelihood and posterior functions, including error checks etc. — createBayesianSetup â€¢ BayesianTools</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">BayesianTools</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/BayesianTools.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/florianhartig/BayesianTools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Creates a standardized collection of prior, likelihood and posterior functions, including error checks etc.</h1>
    </div>

    
    <p>Creates a standardized collection of prior, likelihood and posterior functions, including error checks etc.</p>
    

    <pre class="usage"><span class='fu'>createBayesianSetup</span>(<span class='no'>likelihood</span>, <span class='kw'>prior</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>priorSampler</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>lower</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>upper</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>best</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>names</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>parallelOptions</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>variables</span> <span class='kw'>=</span> <span class='st'>"all"</span>, <span class='kw'>packages</span> <span class='kw'>=</span> <span class='st'>"all"</span>,
  <span class='kw'>dlls</span> <span class='kw'>=</span> <span class='kw'>NULL</span>), <span class='kw'>catchDuplicates</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>likelihood</th>
      <td><p>log likelihood density function</p></td>
    </tr>
    <tr>
      <th>prior</th>
      <td><p>either a prior class (see <code><a href='createPrior.html'>createPrior</a></code>) or a log prior density</p></td>
    </tr>
    <tr>
      <th>priorSampler</th>
      <td><p>if a prior density (and not a prior class) is provided to prior, the optional prior sampling function can be provided here</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>parallelization option. Default is F. Other options are T, or "external". See details.</p></td>
    </tr>
    <tr>
      <th>lower</th>
      <td><p>vector with lower prior limits</p></td>
    </tr>
    <tr>
      <th>upper</th>
      <td><p>vector with upper prior limits</p></td>
    </tr>
    <tr>
      <th>best</th>
      <td><p>vector with best values</p></td>
    </tr>
    <tr>
      <th>names</th>
      <td><p>optional vector with parameter names</p></td>
    </tr>
    <tr>
      <th>parallelOptions</th>
      <td><p>list containing three lists. First "packages" determines the R packages necessary to run the likelihood function. Second "variables" the objects in the global envirnment needed to run the likelihood function and third "dlls" the DLLs needed to run the likelihood function (see Details and Examples).</p></td>
    </tr>
    <tr>
      <th>catchDuplicates</th>
      <td><p>Logical, determines whether unique parameter combinations should only be evaluated once. Only used when the likelihood accepts a matrix with parameter as columns.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>If lower and upper (and optionally best) but not a prior object are passed, the function will create an uniform prior with the limits lower and upper. If a prior object and lower and upper are passed, the function will ignore lower and upper, and will only use the prior object.</p>
<p>For parallelization, option T means that an automatic parallelization via R is attempted, or "external", in which case it is assumed that the likelihood is already parallelized. In this case it needs to accept a matrix with parameters as columns.
Further you can specify the packages, objects and DLLs that are exported to the cluster. 
By default a copy of your workspace is exported. However, depending on your workspace this can be very inefficient.</p>
<p>For more details, make sure to read the vignette (run vignette("BayesianTools", package="BayesianTools")</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='checkBayesianSetup.html'>checkBayesianSetup</a></code> 
         <code><a href='createLikelihood.html'>createLikelihood</a></code> 
         <code><a href='createPrior.html'>createPrior</a></code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>ll</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'>sum</span>(<span class='fu'>dnorm</span>(<span class='no'>x</span>, <span class='kw'>log</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>))

<span class='no'>test</span> <span class='kw'>&lt;-</span> <span class='fu'>createBayesianSetup</span>(<span class='no'>ll</span>, <span class='kw'>prior</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>priorSampler</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>lower</span> <span class='kw'>=</span> -<span class='fl'>10</span>, <span class='kw'>upper</span> <span class='kw'>=</span> <span class='fl'>10</span>)
<span class='fu'>str</span>(<span class='no'>test</span>)</div><div class='output co'>#&gt; List of 7
#&gt;  $ prior     :List of 6
#&gt;   ..$ density        :function (x)  
#&gt;   .. ..- attr(*, "srcref")=Class 'srcref'  atomic [1:8] 59 21 63 3 21 3 59 63
#&gt;   .. .. .. ..- attr(*, "srcfile")=Classes 'srcfilecopy', 'srcfile' &lt;environment: 0x000000002766d2b8&gt; 
#&gt;   ..$ sampler        :function (n = NULL)  
#&gt;   .. ..- attr(*, "srcref")=Class 'srcref'  atomic [1:8] 68 24 76 5 24 5 68 76
#&gt;   .. .. .. ..- attr(*, "srcfile")=Classes 'srcfilecopy', 'srcfile' &lt;environment: 0x000000002766d2b8&gt; 
#&gt;   ..$ lower          : num -10
#&gt;   ..$ upper          : num 10
#&gt;   ..$ best           : num 0
#&gt;   ..$ originalDensity:function (x)  
#&gt;   .. ..- attr(*, "srcref")=Class 'srcref'  atomic [1:8] 101 14 104 3 14 3 101 104
#&gt;   .. .. .. ..- attr(*, "srcfile")=Classes 'srcfilecopy', 'srcfile' &lt;environment: 0x000000002766d2b8&gt; 
#&gt;   ..- attr(*, "class")= chr "prior"
#&gt;  $ likelihood:List of 3
#&gt;   ..$ density:function (x, ...)  
#&gt;   .. ..- attr(*, "srcref")=Class 'srcref'  atomic [1:8] 45 21 95 3 21 3 45 95
#&gt;   .. .. .. ..- attr(*, "srcfile")=Classes 'srcfilecopy', 'srcfile' &lt;environment: 0x00000000255f6b60&gt; 
#&gt;   ..$ sampler: NULL
#&gt;   ..$ cl     : NULL
#&gt;   ..- attr(*, "class")= chr "likelihood"
#&gt;  $ posterior :List of 1
#&gt;   ..$ density:function (x, returnAll = F)  
#&gt;   .. ..- attr(*, "srcref")=Class 'srcref'  atomic [1:8] 9 16 41 3 16 3 9 41
#&gt;   .. .. .. ..- attr(*, "srcfile")=Classes 'srcfilecopy', 'srcfile' &lt;environment: 0x0000000028eeb968&gt; 
#&gt;   ..- attr(*, "class")= chr "posterior"
#&gt;  $ names     : chr "par 1"
#&gt;  $ numPars   : int 1
#&gt;  $ model     : NULL
#&gt;  $ parallel  : logi FALSE
#&gt;  - attr(*, "class")= chr "BayesianSetup"</div><div class='input'><span class='no'>test</span>$<span class='no'>prior</span>$<span class='fu'>density</span>(<span class='fl'>0</span>)</div><div class='output co'>#&gt; [1] -2.995732</div><div class='input'>
<span class='no'>test</span>$<span class='no'>likelihood</span>$<span class='fu'>density</span>(<span class='fu'>c</span>(<span class='fl'>1</span>,<span class='fl'>1</span>))</div><div class='output co'>#&gt; [1] -2.837877</div><div class='input'><span class='no'>test</span>$<span class='no'>likelihood</span>$<span class='fu'>density</span>(<span class='fl'>1</span>)</div><div class='output co'>#&gt; [1] -1.418939</div><div class='input'><span class='no'>test</span>$<span class='no'>posterior</span>$<span class='fu'>density</span>(<span class='fl'>1</span>)</div><div class='output co'>#&gt; [1] -4.414671</div><div class='input'><span class='no'>test</span>$<span class='no'>posterior</span>$<span class='fu'>density</span>(<span class='fl'>1</span>, <span class='kw'>returnAll</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; [1] -4.414671 -1.418939 -2.995732</div><div class='input'>
<span class='no'>test</span>$<span class='no'>likelihood</span>$<span class='fu'>density</span>(<span class='fu'>matrix</span>(<span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fl'>4</span>), <span class='kw'>nrow</span> <span class='kw'>=</span> <span class='fl'>2</span>))</div><div class='output co'>#&gt; [1] -2.837877 -2.837877</div><div class='input'><span class='co'>#test$posterior$density(matrix(rep(1,4), nrow = 2), returnAll = TRUE)</span>
<span class='no'>test</span>$<span class='no'>likelihood</span>$<span class='fu'>density</span>(<span class='fu'>matrix</span>(<span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fl'>4</span>), <span class='kw'>nrow</span> <span class='kw'>=</span> <span class='fl'>4</span>))</div><div class='output co'>#&gt; [1] -1.418939 -1.418939 -1.418939 -1.418939</div><div class='input'>


<span class='co'>## Example of how to use parallelization using the VSEM model</span>
<span class='co'># Note that the parallelization produces overhead and is not always</span>
<span class='co'># speeding things up. In this example, due to the small</span>
<span class='co'># computational cost of the VSEM the parallelization is</span>
<span class='co'># most likely to reduce the speed of the sampler.</span>

<span class='co'># Creating reference data</span>
<span class='no'>PAR</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='VSEMcreatePAR.html'>VSEMcreatePAR</a></span>(<span class='fl'>1</span>:<span class='fl'>1000</span>)
<span class='no'>refPars</span>   <span class='kw'>&lt;-</span> <span class='fu'><a href='VSEMgetDefaults.html'>VSEMgetDefaults</a></span>()
<span class='no'>refPars</span>[<span class='fl'>12</span>,] <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='fl'>0.2</span>, <span class='fl'>0.001</span>, <span class='fl'>1</span>)
<span class='fu'>rownames</span>(<span class='no'>refPars</span>)[<span class='fl'>12</span>] <span class='kw'>&lt;-</span> <span class='st'>"error-sd"</span>

<span class='no'>referenceData</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='VSEM.html'>VSEM</a></span>(<span class='no'>refPars</span>$<span class='no'>best</span>[<span class='fl'>1</span>:<span class='fl'>11</span>], <span class='no'>PAR</span>)
<span class='no'>obs</span> <span class='kw'>=</span> <span class='fu'>apply</span>(<span class='no'>referenceData</span>, <span class='fl'>2</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>x</span> + <span class='fu'>rnorm</span>(<span class='fu'>length</span>(<span class='no'>x</span>),
                                                    <span class='kw'>sd</span> <span class='kw'>=</span> <span class='fu'>abs</span>(<span class='no'>x</span>) * <span class='no'>refPars</span>$<span class='no'>best</span>[<span class='fl'>12</span>]))

<span class='co'># Selecting parameters</span>
<span class='no'>parSel</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>1</span>:<span class='fl'>6</span>, <span class='fl'>12</span>)


<span class='co'>## Builidng the likelihood function</span>
<span class='no'>likelihood</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>par</span>, <span class='no'>sum</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>){
  <span class='no'>x</span> <span class='kw'>=</span> <span class='no'>refPars</span>$<span class='no'>best</span>
  <span class='no'>x</span>[<span class='no'>parSel</span>] <span class='kw'>=</span> <span class='no'>par</span>
  <span class='no'>predicted</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='VSEM.html'>VSEM</a></span>(<span class='no'>x</span>[<span class='fl'>1</span>:<span class='fl'>11</span>], <span class='no'>PAR</span>)
  <span class='no'>diff</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='no'>predicted</span>[,<span class='fl'>1</span>:<span class='fl'>3</span>] - <span class='no'>obs</span>[,<span class='fl'>1</span>:<span class='fl'>3</span>])
  <span class='no'>llValues</span> <span class='kw'>=</span> <span class='fu'>dnorm</span>(<span class='no'>diff</span>, <span class='kw'>sd</span> <span class='kw'>=</span> <span class='fu'>max</span>(<span class='fu'>abs</span>(<span class='fu'>c</span>(<span class='no'>predicted</span>[,<span class='fl'>1</span>:<span class='fl'>3</span>])),<span class='fl'>0.0001</span>) * <span class='no'>x</span>[<span class='fl'>12</span>], <span class='kw'>log</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
  <span class='kw'>if</span> (<span class='no'>sum</span> <span class='kw'>==</span> <span class='no'>False</span>) <span class='fu'>return</span>(<span class='no'>llValues</span>)
  <span class='kw'>else</span> <span class='fu'>return</span>(<span class='fu'>sum</span>(<span class='no'>llValues</span>))
}

<span class='co'># Prior</span>
<span class='no'>prior</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='createUniformPrior.html'>createUniformPrior</a></span>(<span class='kw'>lower</span> <span class='kw'>=</span> <span class='no'>refPars</span>$<span class='no'>lower</span>[<span class='no'>parSel</span>], <span class='kw'>upper</span> <span class='kw'>=</span> <span class='no'>refPars</span>$<span class='no'>upper</span>[<span class='no'>parSel</span>])


<span class='co'>####</span>
<span class='co'>## Definition of the packages and objects that are exported to the cluster.</span>
<span class='co'># These are the objects that are used in the likelihood function.</span>
<span class='no'>opts</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(<span class='kw'>packages</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='st'>"BayesianTools"</span>), <span class='kw'>variables</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='st'>"refPars"</span>, <span class='st'>"obs"</span>, <span class='st'>"PAR"</span> ),
             <span class='kw'>dlls</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)


<span class='co'># Create Bayesian Setup</span>
<span class='no'>BSVSEM</span> <span class='kw'>&lt;-</span> <span class='fu'>createBayesianSetup</span>(<span class='no'>likelihood</span>, <span class='no'>prior</span>, <span class='kw'>best</span> <span class='kw'>=</span> <span class='no'>refPars</span>$<span class='no'>best</span>[<span class='no'>parSel</span>],
                              <span class='kw'>names</span> <span class='kw'>=</span> <span class='fu'>rownames</span>(<span class='no'>refPars</span>)[<span class='no'>parSel</span>], <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>2</span>,
                              <span class='kw'>parallelOptions</span> <span class='kw'>=</span> <span class='no'>opts</span>)</div><div class='output co'>#&gt; <span class='error'>Error in get(name, envir = envir): object 'refPars' not found</span></div><div class='input'>
<span class='co'>## The bayesianSetup can now be used in the runMCMC function.</span>
<span class='co'># Note that not all samplers can make use of parallel</span>
<span class='co'># computing.</span>

<span class='co'># Remove the Bayesian Setup and close the cluster</span>
<span class='fu'><a href='stopParallel.html'>stopParallel</a></span>(<span class='no'>BSVSEM</span>)
<span class='fu'>rm</span>(<span class='no'>BSVSEM</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: object 'BSVSEM' not found</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Florian Hartig

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Florian Hartig, Francesco Minunno, Stefan  Paul.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
